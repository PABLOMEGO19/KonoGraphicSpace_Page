<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administrador - Kono Graphic</title>
    <link rel="stylesheet" href="css/estilos.css" type="text/css"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="shortcut icon" href="favicons/favicon_32.ico" type="image/x-icon"/>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
        }

        .admin-header {
            background: #2c2c2c;
            color: #e0e0e0;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .admin-nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .admin-brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-brand img {
            width: 35px;
            height: 30px;
        }

        .admin-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-user span {
            font-weight: 500;
        }

        .logout-btn {
            background: #444;
            color: #e0e0e0;
            border: 1px solid #555;
            padding: 6px 12px;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .logout-btn:hover {
            background: #555;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .admin-title {
            font-size: 36px;
            margin-bottom: 20px;
            color: #e0e0e0;
            text-align: center;
            font-weight: 300;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            justify-content: center;
            align-items: start;
            min-height: 200px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background: #2c2c2c;
            padding: 40px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: none;
            text-align: center;
            max-width: 300px;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        .dashboard-card h3 {
            color: #e0e0e0;
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: 400;
        }

        .dashboard-card p {
            color: #b0b0b0;
            margin-bottom: 0;
            line-height: 1.5;
            font-size: 14px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: #444;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px auto;
        }

        .card-icon::before {
            content: '';
            width: 20px;
            height: 20px;
            background: #e0e0e0;
            mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5.5 0 0 0-.5-.5h-3zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 9h3A1.5 1.5 0 0 1 15 10.5v3A1.5 1.5 0 0 1-1.5 1.5h-3a1.5 1.5 0 0 1-1.5-1.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/></svg>') no-repeat center;
            mask-size: contain;
        }

        .videos-card .card-icon::before {
            mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M6.271 5.055a.5.5 0 0 1 .52.038l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .271-.445z"/></svg>') no-repeat center;
        }

        .stats-section,
        .stats-grid,
        .stat-item,
        .stat-number,
        .stat-label,
        .recent-activity,
        .activity-title,
        .activity-item,
        .activity-icon,
        .activity-content,
        .activity-text,
        .activity-time {
            display: none;
        }

        /* Admin Layout */
        .admin-container {
            display: flex;
            min-height: calc(100vh - 80px);
            background: #1a1a1a;
        }

        .admin-sidebar {
            width: 250px;
            background: #252525;
            padding: 20px 0;
            border-right: 1px solid #333;
        }

        .admin-sidebar nav ul {
            list-style: none;
        }

        .admin-sidebar nav a {
            display: block;
            padding: 12px 25px;
            color: #e0e0e0;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .admin-sidebar nav a:hover,
        .admin-sidebar nav a.active {
            background: #333;
            color: #fff;
            border-left: 3px solid #4CAF50;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .dashboard-card {
            background: #2c2c2c;
            border-radius: 10px;
            padding: 25px 20px;
            color: #fff;
            text-decoration: none;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            border: 1px solid #3a3a3a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-color: #4CAF50;
        }

        .dashboard-card .card-icon {
            font-size: 32px;
            margin-bottom: 15px;
            color: #4CAF50;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 60px;
            height: 60px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 50%;
            margin-bottom: 20px;
        }

        .dashboard-card h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
            color: #fff;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .dashboard-card p {
            margin: 0;
            color: #aaa;
            font-size: 14px;
            line-height: 1.5;
            max-width: 200px;
        }

        .admin-main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        /* Video Management Styles */
        .admin-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .add-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .add-button:hover {
            background: #45a049;
        }

        .video-form {
            max-width: 800px;
            margin: 0 auto;
            background: #252525;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 25px;
        }

        .cancel-button {
            background: #666;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .cancel-button:hover {
            background: #555;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .admin-container {
                flex-direction: column;
            }

            .admin-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #333;
            }

            .admin-sidebar nav ul {
                display: flex;
                overflow-x: auto;
            }

            .admin-sidebar nav a {
                white-space: nowrap;
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .admin-sidebar nav a:hover,
            .admin-sidebar nav a.active {
                border-left: none;
                border-bottom: 3px solid #4CAF50;
            }
        }

        @media (max-width: 768px) {
            .admin-nav {
                flex-direction: column;
                gap: 15px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .admin-title {
                font-size: 24px;
            }

            .admin-main-content {
                padding: 20px 15px;
            }

            .form-actions {
                flex-direction: column;
            }

            .form-actions button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <nav class="admin-nav">
            <div class="admin-brand">
                <img src="img/img_nav_blanco/Logo_Icon_blanco.png" alt="Logo">
                <span>Panel de Administrador</span>
            </div>
            <div class="admin-user">
                <span>Bienvenido, <strong id="adminUsername">Admin</strong></span>
                <a href="#" onclick="logout()" class="logout-btn">Cerrar Sesión</a>
            </div>
        </nav>
    </header>

    <main class="admin-container">
        <div class="admin-sidebar">
            <nav>
                <ul>
                    <li><a href="#" onclick="navigateTo('dashboard')" class="active">Dashboard</a></li>
                    <li><a href="#" onclick="navigateTo('videos')">Videos Mi Trabajo</a></li>
                </ul>
            </nav>
        </div>
        
        <div class="admin-main-content">
            <h1 class="admin-title">Dashboard de Administración</h1>

        <div class="dashboard-grid">
            <div class="admin-content">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="admin-section active">
                    <h2>Dashboard</h2>
                    <p>Bienvenido al panel de administración. Selecciona una opción para comenzar.</p>
                    
                    <div class="dashboard-cards">
                        <div class="dashboard-card" onclick="navigateTo('videos')">
                            <div class="card-icon">
                                <span class="material-icons">video_library</span>
                            </div>
                            <h3>Videos Mi Trabajo</h3>
                            <p>Administra los videos de la sección Mi Trabajo</p>
                        </div>
                    </div>
                </div>

                <!-- Videos Section -->
                <div id="videos-section" class="admin-section">
                    <div class="admin-section-header">
                        <h2>Videos Mi Trabajo</h2>
                        <div class="header-actions">
                            <button id="delete-selected-btn" class="delete-multiple-btn" disabled onclick="deleteSelectedVideos()">
                                <span class="material-icons">delete</span> Eliminar (0)
                            </button>
                            <button onclick="navigateTo('add-video')" class="add-btn">
                                <span class="material-icons">add</span> Añadir Video
                            </button>
                        </div>
                    </div>
                    
                    <!-- Lista de Videos -->
                    <div id="videos-container" class="videos-list">
                        <!-- Los videos se cargarán aquí dinámicamente -->
                    </div>
                </div>

                <!-- Añadir/Editar Video -->
                <div id="add-video-section" class="admin-section">
                    <h2><span id="form-title">Añadir</span> Video</h2>
                    <form id="video-form">
                        <div class="form-group">
                            <label for="video-title">Título del Video</label>
                            <input type="text" id="video-title" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="video-short-description">Descripción Corta</label>
                            <input type="text" id="video-short-description" required>
                            <small>Aparecerá debajo del título en la lista de vídeos</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="video-description">Descripción Larga</label>
                            <textarea id="video-description" rows="5" required></textarea>
                            <small>Aparecerá en la página detallada del vídeo</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="video-page-url">URL Personalizada (opcional)</label>
                            <input type="url" id="video-page-url" placeholder="Dejar en blanco para generar automáticamente">
                        </div>
                        
                        <div class="form-group">
                            <label for="video-youtube">URL de YouTube</label>
                            <input type="url" id="video-youtube" placeholder="https://www.youtube.com/watch?v=..." required>
                            <small>URL completa del vídeo en YouTube</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="video-thumbnail">URL de la Miniatura (opcional si usas YouTube)</label>
                            <input type="url" id="video-thumbnail" placeholder="Deja en blanco para usar miniatura de YouTube">
                            <small>Si se deja en blanco, se usará la miniatura de YouTube</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="video-tags">Etiquetas (separadas por comas)</label>
                            <input type="text" id="video-tags" placeholder="ej: video, tutorial, edicion" required>
                            <small>La primera etiqueta se usará como categoría principal</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Visibilidad</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="visibility" value="public" checked> Público
                                </label>
                                <label>
                                    <input type="radio" name="visibility" value="private"> Privado
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Guardar Video</button>
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('video-form').reset();">Limpiar</button>
                            <button type="button" class="test-btn" onclick="fillTestData()">Rellenar con datos de prueba</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Verificar autenticación
        if (sessionStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = 'admin_login.html';
        }

        // Mostrar nombre de usuario
        const username = sessionStorage.getItem('adminUsername');
        if (username) {
            document.getElementById('adminUsername').textContent = username.charAt(0).toUpperCase() + username.slice(1);
        }

        // Datos de ejemplo para videos
        let videos = JSON.parse(localStorage.getItem('videos')) || [];
        let currentEditIndex = -1;

        // Función para guardar videos en localStorage
        function saveVideos() {
            // Asegurarse de que cada video tenga un campo de orden
            videos = videos.map((video, index) => ({
                ...video,
                order: video.order !== undefined ? video.order : index
            }));
            
            // Ordenar los videos por el campo 'order'
            videos.sort((a, b) => (a.order || 0) - (b.order || 0));
            
            // Actualizar los índices de orden por si hay huecos
            videos.forEach((video, index) => {
                video.order = index;
            });
            
            localStorage.setItem('videos', JSON.stringify(videos));
            
            // Disparar evento personalizado para notificar a otras pestañas
            const event = new Event('videosUpdated');
            window.dispatchEvent(event);
        }

        // Función para renderizar la lista de videos
        function renderVideos() {
            const container = document.getElementById('videos-container');
            container.innerHTML = '';
            
            // Asegurarse de que los videos estén ordenados
            videos.sort((a, b) => (a.order || 0) - (b.order || 0));
            
            // Contadores para estadísticas
            let publicCount = 0;
            let hiddenCount = 0;

            // Crear encabezado de la tabla
            const header = document.createElement('div');
            header.className = 'video-item header';
            header.innerHTML = `
                <div class="video-checkbox">
                    <input type="checkbox" id="select-all" onchange="toggleSelectAll(this)">
                    <label for="select-all"></label>
                </div>
                <div class="video-preview">
                    <span>Vista previa</span>
                </div>
                <div class="video-title">Título</div>
                <div class="video-visibility">Visibilidad</div>
                <div class="video-actions">Acciones</div>
            `;
            container.appendChild(header);

            // Agregar cada video a la lista
            videos.forEach((video, index) => {
                // Actualizar contadores
                if (video.isPublic) {
                    publicCount++;
                } else {
                    hiddenCount++;
                }
                
                const videoElement = document.createElement('div');
                videoElement.className = `video-item ${video.isPublic ? '' : 'video-hidden'}`;
                videoElement.innerHTML = `
                    <div class="video-checkbox">
                        <input type="checkbox" id="video-${index}" class="video-checkbox-input" onchange="updateDeleteButton()">
                        <label for="video-${index}"></label>
                    </div>
                    <div class="video-preview">
                        <img src="${video.thumbnail}" alt="${video.title}" width="120">
                    </div>
                    <div class="video-info">
                        <h3>${video.title} ${!video.isPublic ? '<span class="visibility-badge">Oculto</span>' : ''}</h3>
                        <p>${video.description.substring(0, 100)}${video.description.length > 100 ? '...' : ''}</p>
                        <div class="video-tags">
                            ${video.tags.map(tag => `
                                <span class="tag">${tag}</span>
                            `).join('')}
                        </div>
                    </div>
                    <div class="video-visibility">
                        <button onclick="toggleVideoVisibility(${index}, ${!video.isPublic})" class="visibility-toggle ${video.isPublic ? 'is-visible' : 'is-hidden'}">
                            <span class="material-icons">${video.isPublic ? 'visibility' : 'visibility_off'}</span>
                            ${video.isPublic ? 'Público' : 'Oculto'}
                        </button>
                    </div>
                    <div class="video-actions">
                      <div class="reorder-buttons">
                          <button onclick="moveVideoUp(${index})" class="reorder-btn" title="Mover arriba" ${index === 0 ? 'disabled' : ''}>
                              <span class="material-icons">arrow_upward</span>
                          </button>
                          <button onclick="moveVideoDown(${index})" class="reorder-btn" title="Mover abajo" ${index === videos.length - 1 ? 'disabled' : ''}>
                              <span class="material-icons">arrow_downward</span>
                          </button>
                      </div>
                      <button onclick="editVideo(${index})" class="edit-btn" title="Editar">
                          <span class="material-icons">edit</span>
                      </button>
                      <button onclick="deleteVideo(${index})" class="delete-btn" title="Eliminar">
                          <span class="material-icons">delete</span>
                      </button>
                  </div>
                `;
                container.appendChild(videoElement);
            });
            
            // Actualizar el estado del botón de eliminar seleccionados
            updateDeleteButton();
            
            // Actualizar contadores en el encabezado
            const headerElement = document.querySelector('.admin-section-header h2');
            if (headerElement) {
                headerElement.innerHTML = `Videos Publicados <span class="video-count">${videos.length} total (${publicCount} públicos, ${hiddenCount} ocultos)</span>`;
            }
        }
        
        // Función para seleccionar/deseleccionar todos los videos
        function toggleSelectAll(checkbox) {
            const checkboxes = document.querySelectorAll('.video-checkbox-input');
            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
            });
            updateDeleteButton();
        }
        
        // Función para actualizar el estado del botón de eliminar seleccionados
        function updateDeleteButton() {
            const deleteBtn = document.getElementById('delete-selected-btn');
            const selectedCount = document.querySelectorAll('.video-checkbox-input:checked').length;
            
            deleteBtn.disabled = selectedCount === 0;
            deleteBtn.textContent = `Eliminar (${selectedCount})`;
        }
        
        // Función para cambiar la visibilidad de un video
        function toggleVideoVisibility(index, isPublic) {
            if (index >= 0 && index < videos.length) {
                videos[index].isPublic = isPublic;
                saveVideos();
                
                // Mostrar notificación
                const status = isPublic ? 'público' : 'oculto';
                showNotification(`El video ahora está ${status}`);
            }
        }
        
        // Función para mostrar notificaciones
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <span class="material-icons">${type === 'success' ? 'check_circle' : 'info'}</span>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Eliminar la notificación después de 3 segundos
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Función para eliminar los videos seleccionados
        function deleteSelectedVideos() {
            if (!confirm('¿Estás seguro de que quieres eliminar los videos seleccionados?')) {
                return;
            }
            
            const checkboxes = document.querySelectorAll('.video-checkbox-input:checked');
            const indicesToDelete = Array.from(checkboxes).map(cb => parseInt(cb.id.split('-')[1]));
            
            // Ordenar de mayor a menor para evitar problemas con los índices al eliminar
            indicesToDelete.sort((a, b) => b - a);
            
            // Eliminar los videos seleccionados
            indicesToDelete.forEach(index => {
                if (index >= 0 && index < videos.length) {
                    videos.splice(index, 1);
                }
            });
            
            // Guardar cambios y actualizar la vista
            saveVideos();
            renderVideos();
        }

        // Función para agregar o actualizar un video
        async function saveVideo() {
            const title = document.getElementById('video-title').value;
            const description = document.getElementById('video-description').value;
            const pageUrl = document.getElementById('video-page-url').value;
            const youtubeUrl = document.getElementById('video-youtube').value;
            const thumbnailUrl = document.getElementById('video-thumbnail').value;
            const tags = document.getElementById('video-tags').value.split(',').map(tag => tag.trim());
            const isPublic = document.querySelector('input[name="visibility"]:checked').value === 'public';
            const shortDescription = document.getElementById('video-short-description')?.value || '';
            const longDescription = document.getElementById('video-description').value || description;
            
            // Extraer el ID del vídeo de YouTube
            let youtubeId = '';
            try {
                const url = new URL(youtubeUrl);
                if (url.hostname.includes('youtube.com') || url.hostname.includes('youtu.be')) {
                    if (url.hostname.includes('youtube.com')) {
                        youtubeId = url.searchParams.get('v');
                    } else if (url.hostname.includes('youtu.be')) {
                        youtubeId = url.pathname.split('/').pop();
                    }
                }
            } catch (e) {
                console.error('Error al procesar la URL de YouTube:', e);
            }
            
            // Si no se pudo extraer el ID, mostrar error
            if (!youtubeId) {
                showNotification('Por favor, introduce una URL de YouTube válida', 'error');
                return;
            }
            
            // Generar URL de miniatura de YouTube si no se proporciona una miniatura
            const finalThumbnailUrl = thumbnailUrl || 
                `https://img.youtube.com/vi/${youtubeId}/maxresdefault.jpg`;
            
            // Crear un ID único para el vídeo basado en el título
            const videoId = title.toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/(^-|-$)/g, '');

            const videoData = {
                id: videoId,
                title,
                description,
                shortDescription,
                longDescription,
                tag: tags[0] || 'Sin etiqueta',
                pageUrl: pageUrl || `/videos/${videoId}`,
                youtubeUrl,
                youtubeId,
                thumbnail: finalThumbnailUrl,
                tags: [...new Set(tags)], // Eliminar duplicados
                isPublic: isPublic,
                createdAt: new Date().toISOString(),
                // Para compatibilidad con la generación de páginas
                images: [
                    finalThumbnailUrl,
                    `https://img.youtube.com/vi/${youtubeId}/mqdefault.jpg`
                ]
            };

            try {
                // Generar la página del vídeo
                const pageResult = await generateVideoPage(videoData);
                
                if (pageResult && pageResult.success) {
                    // Si la página se generó correctamente, actualizamos la URL
                    videoData.pageUrl = pageResult.pageUrl;
                    
                    // Mostrar notificación de éxito
                    showNotification('Vídeo guardado y página generada correctamente', 'success');
                } else {
                    console.warn('No se pudo generar la página del vídeo:', pageResult?.error);
                    showNotification('Vídeo guardado, pero hubo un error al generar la página', 'warning');
                }
                
                if (currentEditIndex === -1) {
                    // Agregar nuevo video
                    videos.push(videoData);
                } else {
                    // Actualizar video existente
                    videos[currentEditIndex] = videoData;
                    currentEditIndex = -1;
                    document.getElementById('video-form').querySelector('button[type="submit"]').textContent = 'Agregar Video';
                }

                saveVideos();
                document.getElementById('video-form').reset();
                
                // Recargar la lista de vídeos
                renderVideos();
                
            } catch (error) {
                console.error('Error al guardar el vídeo:', error);
                showNotification('Error al guardar el vídeo: ' + error.message, 'error');
            }
        }

        // Función para editar un video
        function editVideo(index) {
            const video = videos[index];
            document.getElementById('video-title').value = video.title || '';
            document.getElementById('video-short-description').value = video.shortDescription || video.description || '';
            document.getElementById('video-description').value = video.longDescription || video.description || '';
            document.getElementById('video-page-url').value = video.pageUrl || '';
            document.getElementById('video-youtube').value = video.youtubeUrl || '';
            document.getElementById('video-thumbnail').value = video.thumbnail || '';
            
            // Manejar las etiquetas (pueden venir como array o como string)
            if (Array.isArray(video.tags)) {
                document.getElementById('video-tags').value = video.tags.join(', ');
            } else if (typeof video.tags === 'string') {
                document.getElementById('video-tags').value = video.tags;
            } else {
                document.getElementById('video-tags').value = '';
            }
            
            // Establecer la visibilidad (por defecto a público si no está definido)
            const visibilityValue = (video.isPublic !== undefined) ? 
                (video.isPublic ? 'public' : 'private') : 'public';
            document.querySelector(`input[name="visibility"][value="${visibilityValue}"]`).checked = true;
            
            // Actualizar el título del formulario y el índice actual
            document.getElementById('form-title').textContent = 'Editar';
            currentEditIndex = index;
            
            // Actualizar el texto del botón de envío
            document.getElementById('video-form').querySelector('button[type="submit"]').textContent = 'Actualizar Video';
            
            // Desplazarse al formulario
            document.getElementById('add-video-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Función para eliminar un video
        function deleteVideo(index) {
            if (confirm('¿Estás seguro de que quieres eliminar este video?')) {
                videos.splice(index, 1);
                saveVideos();
            }
        }

        // Función para actualizar la página de Mi Trabajo
        function updateMiTrabajoPage() {
            // Guardar los videos en localStorage
            localStorage.setItem('videos', JSON.stringify(videos));
            
            // Disparar un evento personalizado para notificar a otras pestañas
            const event = new StorageEvent('storage', {
                key: 'videos',
                newValue: JSON.stringify(videos)
            });
            window.dispatchEvent(event);
            
            // Si estamos en la sección de videos, actualizar la lista
            if (document.getElementById('videos-section').classList.contains('active')) {
                renderVideos();
            }
            
            // Mostrar mensaje de éxito
            alert('Videos actualizados correctamente');
        }

        // Función de logout
        function logout() {
            // Aquí iría la lógica de cierre de sesión
            alert('Cerrando sesión...');
            window.location.href = 'admin_login.html';
        }

        // Función para navegar
        function navigateTo(section) {
            // Ocultar todas las secciones
            document.querySelectorAll('.admin-section').forEach(sec => sec.classList.remove('active'));
            
            // Mostrar la sección seleccionada
            const sectionElement = document.getElementById(section + '-section');
            if (sectionElement) {
                sectionElement.classList.add('active');
            }
            
            // Actualizar la clase active en la navegación
            document.querySelectorAll('.admin-sidebar a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(section)) {
                    link.classList.add('active');
                }
            });
            
            // Manejar casos especiales
            if (section === 'add-video') {
                document.title = 'Añadir Video | Panel de Administración';
            } else if (section === 'videos') {
                document.title = 'Gestión de Videos | Panel de Administración';
                renderVideos();
            } else {
                document.title = 'Panel de Administración';
            }
        }

        // Función para rellenar el formulario con datos de prueba
        function fillTestData() {
            // Datos de prueba
            const testData = {
                title: 'Título del Video de Prueba',
                description: 'Esta es una descripción de ejemplo para el video de prueba. Aquí puedes incluir detalles sobre el contenido del video.',
                pageUrl: 'https://www.ejemplo.com/video-prueba',
                thumbnail: 'https://i.ytimg.com/vi/dQw4w9WgXcQ/maxresdefault.jpg',
                tags: 'gaming, entretenimiento, review'
            };

            // Rellenar los campos del formulario
            document.getElementById('video-title').value = testData.title;
            document.getElementById('video-description').value = testData.description;
            document.getElementById('video-page-url').value = testData.pageUrl;
            document.getElementById('video-thumbnail').value = testData.thumbnail;
            document.getElementById('video-tags').value = testData.tags;

            // Mostrar un mensaje de confirmación
            alert('Formulario rellenado con datos de prueba. ¡Ahora puedes hacer clic en "Agregar Video" para guardar!');
        }

        // Funciones para reordenar videos
        function moveVideoUp(index) {
            if (index <= 0) return;
            
            // Intercambiar el orden con el video de arriba
            const tempOrder = videos[index].order;
            videos[index].order = videos[index - 1].order;
            videos[index - 1].order = tempOrder;
            
            // Guardar y volver a renderizar
            saveVideos();
            renderVideos();
            showNotification('Orden de videos actualizado');
        }
        
        function moveVideoDown(index) {
            if (index >= videos.length - 1) return;
            
            // Intercambiar el orden con el video de abajo
            const tempOrder = videos[index].order;
            videos[index].order = videos[index + 1].order;
            videos[index + 1].order = tempOrder;
            
            // Guardar y volver a renderizar
            saveVideos();
            renderVideos();
            showNotification('Orden de videos actualizado');
        }
        
        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            renderVideos();
            
            // Manejar el envío del formulario
            document.getElementById('video-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveVideo();
            });
        });
    </script>
    <style>
        .video-item {
            background: #2c2c2c;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: grid;
            grid-template-columns: 40px 120px 1fr auto auto;
            gap: 15px;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .video-item.header {
            background: #3a3a3a;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .video-hidden {
            opacity: 0.7;
            background-color: rgba(44, 44, 44, 0.5);
        }
        
        .video-hidden:hover {
            opacity: 0.9;
        }
        
        .visibility-badge {
            display: inline-block;
            background: #ff9800;
            color: #fff;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        .visibility-options {
            display: flex;
            gap: 15px;
            margin-top: 8px;
        }
        
        .visibility-option {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .visibility-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .visibility-option input[type="radio"] {
            display: none;
        }
        
        .visibility-option input[type="radio"]:checked + .visibility-label {
            font-weight: 600;
        }
        
        .visibility-option input[type="radio"]:checked ~ .visibility-icon {
            color: #4CAF50;
        }
        
        .visibility-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid #555;
            background: #333;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
        }
        
        .visibility-toggle.is-visible {
            background: #2e7d32;
            border-color: #1b5e20;
        }
        
        .visibility-toggle.is-hidden {
            background: #d32f2f;
            border-color: #b71c1c;
        }
        
        .visibility-toggle .material-icons {
            font-size: 16px;
        }
        
        .video-visibility {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .video-count {
            font-size: 14px;
            color: #aaa;
            font-weight: normal;
            margin-left: 10px;
        }
        
        /* Estilos para notificaciones */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 6px;
            background: #333;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            animation: slideIn 0.3s ease-out forwards;
        }
        
        .notification-success {
            background: #2e7d32;
        }
        
        .notification-info {
            background: #1976d2;
        }
        
        .notification.fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }
        
        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            to {
                transform: translateY(100px);
                opacity: 0;
            }
        }
        
        .video-item:hover {
            background: #3a3a3a;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .video-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .video-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .video-preview {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .video-preview img {
            width: 120px;
            height: 68px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .video-info {
            flex: 1;
        }
        
        .video-info h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
            color: #fff;
        }
        
        .video-info p {
            margin: 0 0 8px 0;
            color: #aaa;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .video-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }
        
        .video-tags .tag {
            background: rgba(255, 255, 255, 0.1);
            color: #ddd;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .video-preview {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .video-preview img {
            border-radius: 4px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .delete-multiple-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background-color: #ff4444;
            color: white;
            border: 1px solid #cc0000;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .delete-multiple-btn:disabled {
            background-color: #6c757d;
            border-color: #6c757d;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .delete-multiple-btn:not(:disabled):hover {
            background-color: #cc0000;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .add-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: 1px solid #45a049;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .add-btn:hover {
            background-color: #45a049;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .admin-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .admin-section-header h2 {
            margin: 0;
            color: #fff;
            font-size: 24px;
        }
        
        .video-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .reorder-buttons {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-right: 8px;
        }
        
        .reorder-btn {
            background: transparent;
            border: 1px solid #555;
            border-radius: 4px;
            color: #fff;
            width: 32px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 0;
            transition: all 0.2s ease;
        }
        
        .reorder-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.1);
            border-color: #777;
        }
        
        .reorder-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .reorder-btn .material-icons {
            font-size: 16px;
        }
        
        .video-actions .edit-btn,
        .video-actions .delete-btn {
            padding: 6px 10px;
        }
        
        .video-actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            min-width: 40px;
            height: 40px;
        }
        
        .video-actions .edit-btn {
            background-color: #2196F3;
            color: white;
            border: 1px solid #1976D2;
        }
        
        .video-actions .edit-btn:hover {
            background-color: #1976D2;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .video-actions .delete-btn {
            background-color: #ff4444;
            color: white;
            border: 1px solid #cc0000;
        }
        
        .video-actions .delete-btn:hover {
            background-color: #cc0000;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .video-actions .material-icons {
            font-size: 18px;
        }
        
        
        
        /* Los iconos se manejan directamente con elementos <span class="material-icons"> */
        
        .admin-section {
            display: none;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        
        .form-group input, 
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #444;
            background: #2c2c2c;
            color: #fff;
        }
        
        button[type="submit"] {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button[type="submit"]:hover {
            background: #45a049;
        }
    </style>
    <script src="js/videoPageGenerator.js"></script>
</body>
</html>
